import{o as l,c as d,d as A,H as J,l as F,k as c,I as W,s as k,u as w,D as o,a as e,b as g,t as u,m as N,x as f,n as G,p as K,v as O,q as p,z as Q,J as X}from"./index-B2BqLNcl.js";import{I as M}from"./iconify-BnZ1LStC.js";import{g as Y}from"./getUsers-BunG1t9S.js";import{_ as Z,u as ee,a as se,c as U,s as te,q as oe,o as ae,w as T,d as ne}from"./_plugin-vue_export-helper-B8CnzDvF.js";const le={},de={class:"my-3"},ie=A('<div class="flex flex-col gap-4 w-32 ml-2"><div class="flex gap-2 items-center"><div class="skeleton w-10 h-10 rounded-full shrink-0"></div><div class="flex flex-col gap-2"><div class="skeleton h-2 w-10"></div><div class="skeleton h-2 w-20"></div></div></div></div><div class="flex justify-end mr-5"><div class="flex flex-col gap-4 w-32"><div class="flex gap-2 items-center"><div class="flex flex-col gap-2"><div class="skeleton h-2 w-20"></div><div class="skeleton h-2 w-10"></div></div><div class="skeleton w-10 h-10 rounded-full shrink-0"></div></div></div></div>',2),ce=[ie];function re(C,x){return l(),d("div",de,ce)}const ue=Z(le,[["render",re]]),ve=["onClick"],me={class:"w-10 rounded-full"},_e=["src"],he={class:""},fe={class:"text-sm font-medium"},pe=e("span",{class:"text-xs px-2 bg-blue-500/20 text-blue-500 rounded-full"}," test ",-1),ge={id:"openInbox",class:"modal modal-bottom sm:modal-middle"},xe={class:"modal-box relative pb-4 pt-2 px-2"},ye={class:"modal-action absolute z-10 -top-4 right-2"},be={method:"dialog"},Ie={class:"btn btn-xs px-0.5 rounded-full"},ke={class:"flex justify-start items-center gap-2"},we={class:"avatar"},Ne={class:"w-10 rounded-full"},Me=["src"],Ue={class:"text-sm font-medium"},Te=e("hr",{class:"my-1 border border-gray-400/20"},null,-1),Ce={key:0,class:"my-2 flex justify-center items-center text-sm"},Le={class:"py-1 px-4 bg-primary/10 rounded-full"},$e={class:"text-primary font-semibold"},De={class:"chat-image avatar"},je={class:"w-10 rounded-full"},Be=["src"],Ve=["src"],qe={class:"chat-header text-xs font-medium"},Se={class:"text-[10px] opacity-50"},He={key:1},Re={class:"my-1 flex justify-start items-center gap-2"},ze=["disabled"],Ee={key:0,class:"loading loading-ring loading-lg"},We={__name:"yourChats",setup(C){J();const x=F(),L=c(x.currentUser),{firestore:y}=ee(),{uid:$,photoURL:D,displayName:j}=L.value,i=$,B=j,{storedUsers:V}=Y();let n=c([]);const r=c(""),b=c([]),_=c(!1),v=c(!1),h=c(null),q=t=>{document.getElementById("openInbox").showModal(),n.value=t,console.log(n.value.userId),E()},S=async()=>{if(r.value.trim()!==""){v.value=!0,console.log("sending");try{await se(U(y,"messages"),{senderId:i,recipientId:n.value.userId,message:r.value,timestamp:te()}),console.log("send!"),v.value=!1}catch{}r.value=""}},I=W(()=>b.value.filter(t=>t.senderId===i&&t.recipientId===n.value.userId||t.senderId===n.value.userId&&t.recipientId===i)),H=t=>{if(t){const a=R(t),s=a.getHours()%12||12,m=("0"+a.getMinutes()).slice(-2),P=a.getHours()<12?"am":"pm";return`${s}:${m} ${P}`}},R=t=>{const a=t.nanoseconds/1e6,s=t.seconds;return a?new Date(s*1e3+a):jsDate},z=()=>{X(()=>{h.value&&(h.value.scrollTop=h.value.scrollHeight)})},E=()=>{_.value=!0;const t=oe(U(y,"messages"),T("senderId","in",[i,n.value.userId]),T("recipientId","in",[i,n.value.userId]),ae("timestamp","asc")),a=ne(t,s=>{b.value=s.docs.map(m=>({id:m.id,...m.data()})),_.value=!1,z()});Q(()=>{a&&a()})};return(t,a)=>(l(),d("div",null,[(l(!0),d(k,null,w(o(V),s=>(l(),d("div",{key:s.id},[e("div",{onClick:m=>q(s),class:"flex justify-start items-center gap-2 cursor-pointer hover:bg-gray-500/20 transition p-1 rounded-md"},[e("div",{class:p(["avatar",s.status==="online"?"online":"offline"])},[e("div",me,[e("img",{src:s.userPhotoURL},null,8,_e)])],2),e("div",he,[e("h1",fe,u(s.userName),1),pe])],8,ve)]))),128)),e("dialog",ge,[e("div",xe,[e("div",ye,[e("form",be,[e("button",Ie,[g(o(M),{icon:"carbon:close",class:"text-xl text-red-500"})])])]),e("div",ke,[e("div",we,[e("div",Ne,[e("img",{src:o(n).userPhotoURL},null,8,Me)])]),e("div",null,[e("h1",Ue,u(o(n).userName),1)])]),Te,e("div",{class:"h-80 rounded-md overflow-y-scroll",ref_key:"messageContainer",ref:h},[I.value.length===0&&!_.value?(l(),d("div",Ce,[e("span",Le,[N("No conversation with chef "),e("span",$e,u(o(n).userName),1)])])):f("",!0),(l(!0),d(k,null,w(I.value,s=>(l(),d("div",{key:s.id},[e("div",{class:p(["chat",s.senderId===o(i)?"chat-end":"chat-start"])},[e("div",De,[e("div",je,[o(i)===s.senderId?(l(),d("img",{key:0,src:o(D)},null,8,Be)):(l(),d("img",{key:1,src:o(n).userPhotoURL},null,8,Ve))])]),e("div",qe,[N(u(s.senderId===o(i)?o(B):o(n).userName)+" ",1),e("time",Se,u(H(s.timestamp)),1)]),e("div",{class:p(["chat-bubble text-sm",o(i)===s.senderId?"chat-bubble-primary":""])},u(s.message),3)],2)]))),128)),_.value?(l(),d("div",He,[g(ue)])):f("",!0)],512),e("form",{action:"",onSubmit:G(S,["prevent"])},[e("div",Re,[K(e("input",{type:"text",disabled:v.value,required:"","onUpdate:modelValue":a[0]||(a[0]=s=>r.value=s),placeholder:"Enter a message..",class:"input input-bordered w-full placeholder:text-sm rounded-full"},null,8,ze),[[O,r.value]]),v.value?(l(),d("span",Ee)):f("",!0),v.value?f("",!0):(l(),d("button",{key:1,class:p(["rounded-full btn transition",r.value===""?"hidden":""])},[g(o(M),{icon:"bxs:send",class:"text-xl text-blue-500"})],2))])],32)])])]))}};export{We as default};
