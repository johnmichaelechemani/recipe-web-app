import{o as d,c as n,d as T,l as z,k as u,D as E,s as b,u as y,B as t,a as e,b as h,t as r,m as I,x as w,n as P,p as A,v as F,q as v,z as H}from"./index-DOVgOklS.js";import{I as k}from"./iconify-CiZKYKba.js";import{g as G}from"./getUsers-BIBWmY16.js";import{_ as J,u as K,a as O,s as Q,c as N,q as W,o as X,w as U,d as Y}from"./_plugin-vue_export-helper-dyJCaF5z.js";const Z={},ee={class:"my-3"},se=T('<div class="flex flex-col gap-4 w-32 ml-2"><div class="flex gap-2 items-center"><div class="skeleton w-10 h-10 rounded-full shrink-0"></div><div class="flex flex-col gap-2"><div class="skeleton h-2 w-10"></div><div class="skeleton h-2 w-20"></div></div></div></div><div class="flex justify-end mr-5"><div class="flex flex-col gap-4 w-32"><div class="flex gap-2 items-center"><div class="flex flex-col gap-2"><div class="skeleton h-2 w-20"></div><div class="skeleton h-2 w-10"></div></div><div class="skeleton w-10 h-10 rounded-full shrink-0"></div></div></div></div>',2),te=[se];function oe(M,f){return d(),n("div",ee,te)}const ae=J(Z,[["render",oe]]),de=["onClick"],ne={class:"w-10 rounded-full"},le=["src"],ie={class:""},ce={class:"text-sm font-medium"},re=e("span",{class:"text-xs px-2 bg-blue-500/20 text-blue-500 rounded-full"},"test",-1),ue={id:"openInbox",class:"modal modal-bottom sm:modal-middle"},me={class:"modal-box relative pb-4 pt-2 px-2"},ve={class:"modal-action absolute z-10 -top-4 right-2"},_e={method:"dialog"},he={class:"btn btn-xs rounded-full"},fe={class:"flex justify-start items-center gap-2"},pe={class:"avatar"},xe={class:"w-10 rounded-full"},ge=["src"],be={class:"text-sm font-medium"},ye=e("hr",{class:"my-1 border border-gray-400/20"},null,-1),Ie={class:"h-80 rounded-md overflow-y-scroll"},we={key:0,class:"my-2 flex justify-center items-center text-sm"},ke={class:"py-1 px-4 bg-primary/10 rounded-full"},Ne={class:"text-primary font-semibold"},Ue={class:"chat-image avatar"},Me={class:"w-10 rounded-full"},Le=["src"],$e=["src"],Be={class:"chat-header text-xs font-medium"},Ce={class:"text-[10px] opacity-50"},Ve={key:1},je={class:"my-1 flex justify-start items-center gap-2"},Te={__name:"yourChats",setup(M){const f=z(),L=u(f.currentUser),{firestore:p}=K(),{uid:$,photoURL:B,displayName:C}=L.value,l=$,V=C,{storedUsers:j}=G();let o=u([]);const c=u(""),x=u([]),m=u(!1),q=a=>{document.getElementById("openInbox").showModal(),o.value=a,console.log(o.value.userId),S()},D=async()=>{c.value.trim()!==""&&(await O(N(p,"messages"),{senderId:l,recipientId:o.value.userId,message:c.value,timestamp:Q()}),c.value="")},g=E(()=>x.value.filter(a=>a.senderId===l&&a.recipientId===o.value.userId||a.senderId===o.value.userId&&a.recipientId===l)),R=a=>{const i=a.toDate();return`${i.getHours()}:${i.getMinutes()}`},S=()=>{m.value=!0;const a=W(N(p,"messages"),U("senderId","in",[l,o.value.userId]),U("recipientId","in",[l,o.value.userId]),X("timestamp","asc")),i=Y(a,s=>{x.value=s.docs.map(_=>({id:_.id,..._.data()})),m.value=!1});H(()=>{i&&i()})};return(a,i)=>(d(),n("div",null,[(d(!0),n(b,null,y(t(j),s=>(d(),n("div",{key:s.id},[e("div",{onClick:_=>q(s),class:"flex justify-start items-center gap-2 cursor-pointer hover:bg-gray-500/20 transition p-1 rounded-md"},[e("div",{class:v(["avatar",s.status==="online"?"online":"offline"])},[e("div",ne,[e("img",{src:s.userPhotoURL},null,8,le)])],2),e("div",ie,[e("h1",ce,r(s.userName),1),re])],8,de)]))),128)),e("dialog",ue,[e("div",me,[e("div",ve,[e("form",_e,[e("button",he,[h(t(k),{icon:"carbon:close",class:"text-xl text-red-500"})])])]),e("div",fe,[e("div",pe,[e("div",xe,[e("img",{src:t(o).userPhotoURL},null,8,ge)])]),e("div",null,[e("h1",be,r(t(o).userName),1)])]),ye,e("div",Ie,[g.value.length===0&&!m.value?(d(),n("div",we,[e("span",ke,[I("No conversation with chef "),e("span",Ne,r(t(o).userName),1)])])):w("",!0),(d(!0),n(b,null,y(g.value,s=>(d(),n("div",{key:s.id},[e("div",{class:v(["chat",s.senderId===t(l)?"chat-end":"chat-start"])},[e("div",Ue,[e("div",Me,[t(l)===s.senderId?(d(),n("img",{key:0,src:t(B)},null,8,Le)):(d(),n("img",{key:1,src:t(o).userPhotoURL},null,8,$e))])]),e("div",Be,[I(r(s.senderId===t(l)?t(V):t(o).userName)+" ",1),e("time",Ce,r(R(s.timestamp)),1)]),e("div",{class:v(["chat-bubble text-sm",t(l)===s.senderId?"chat-bubble-primary":""])},r(s.message),3)],2)]))),128)),m.value?(d(),n("div",Ve,[h(ae)])):w("",!0)]),e("form",{action:"",onSubmit:P(D,["prevent"])},[e("div",je,[A(e("input",{type:"text",required:"","onUpdate:modelValue":i[0]||(i[0]=s=>c.value=s),placeholder:"Enter a message..",class:"input input-bordered w-full placeholder:text-sm rounded-full"},null,512),[[F,c.value]]),e("button",{class:v(["rounded-full btn transition",c.value===""?"hidden":""])},[h(t(k),{icon:"bxs:send",class:"text-xl text-blue-500"})],2)])],32)])])]))}};export{Te as default};
