import{o as d,c as l,d as P,l as A,k as r,D as H,s as I,u as w,B as o,a as e,b as p,t as u,m as k,x as h,n as F,p as J,v as G,q as f,z as K}from"./index-Vd3QyJ90.js";import{I as N}from"./iconify-D0zmJUrh.js";import{g as O}from"./getUsers-BtfzF02p.js";import{_ as Q,u as W,a as X,c as M,s as Y,q as Z,o as ee,w as U,d as se}from"./_plugin-vue_export-helper-B3iqaedd.js";const te={},oe={class:"my-3"},ae=P('<div class="flex flex-col gap-4 w-32 ml-2"><div class="flex gap-2 items-center"><div class="skeleton w-10 h-10 rounded-full shrink-0"></div><div class="flex flex-col gap-2"><div class="skeleton h-2 w-10"></div><div class="skeleton h-2 w-20"></div></div></div></div><div class="flex justify-end mr-5"><div class="flex flex-col gap-4 w-32"><div class="flex gap-2 items-center"><div class="flex flex-col gap-2"><div class="skeleton h-2 w-20"></div><div class="skeleton h-2 w-10"></div></div><div class="skeleton w-10 h-10 rounded-full shrink-0"></div></div></div></div>',2),ne=[ae];function de(L,g){return d(),l("div",oe,ne)}const le=Q(te,[["render",de]]),ie=["onClick"],ce={class:"w-10 rounded-full"},re=["src"],ue={class:""},ve={class:"text-sm font-medium"},me=e("span",{class:"text-xs px-2 bg-blue-500/20 text-blue-500 rounded-full"},"test",-1),_e={id:"openInbox",class:"modal modal-bottom sm:modal-middle"},he={class:"modal-box relative pb-4 pt-2 px-2"},fe={class:"modal-action absolute z-10 -top-4 right-2"},pe={method:"dialog"},ge={class:"btn btn-xs px-0.5 rounded-full"},xe={class:"flex justify-start items-center gap-2"},ye={class:"avatar"},be={class:"w-10 rounded-full"},Ie=["src"],we={class:"text-sm font-medium"},ke=e("hr",{class:"my-1 border border-gray-400/20"},null,-1),Ne={class:"h-80 rounded-md overflow-y-scroll"},Me={key:0,class:"my-2 flex justify-center items-center text-sm"},Ue={class:"py-1 px-4 bg-primary/10 rounded-full"},Le={class:"text-primary font-semibold"},$e={class:"chat-image avatar"},De={class:"w-10 rounded-full"},je=["src"],Be=["src"],Ce={class:"chat-header text-xs font-medium"},Te={class:"text-[10px] opacity-50"},Ve={key:1},qe={class:"my-1 flex justify-start items-center gap-2"},Se=["disabled"],Re={key:0,class:"loading loading-ring loading-lg"},He={__name:"yourChats",setup(L){const g=A(),$=r(g.currentUser),{firestore:x}=W(),{uid:D,photoURL:j,displayName:B}=$.value,i=D,C=B,{storedUsers:T}=O();let n=r([]);const c=r(""),y=r([]),_=r(!1),v=r(!1),V=t=>{document.getElementById("openInbox").showModal(),n.value=t,console.log(n.value.userId),z()},q=async()=>{if(c.value.trim()!==""){v.value=!0,console.log("sending");try{await X(M(x,"messages"),{senderId:i,recipientId:n.value.userId,message:c.value,timestamp:Y()}),console.log("send!"),v.value=!1}catch{}c.value=""}},b=H(()=>y.value.filter(t=>t.senderId===i&&t.recipientId===n.value.userId||t.senderId===n.value.userId&&t.recipientId===i)),S=t=>{if(t){const a=R(t),s=a.getHours()%12||12,m=("0"+a.getMinutes()).slice(-2),E=a.getHours()<12?"am":"pm";return`${s}:${m} ${E}`}},R=t=>{const a=t.nanoseconds/1e6,s=t.seconds;return a?new Date(s*1e3+a):jsDate},z=()=>{_.value=!0;const t=Z(M(x,"messages"),U("senderId","in",[i,n.value.userId]),U("recipientId","in",[i,n.value.userId]),ee("timestamp","asc")),a=se(t,s=>{y.value=s.docs.map(m=>({id:m.id,...m.data()})),_.value=!1});K(()=>{a&&a()})};return(t,a)=>(d(),l("div",null,[(d(!0),l(I,null,w(o(T),s=>(d(),l("div",{key:s.id},[e("div",{onClick:m=>V(s),class:"flex justify-start items-center gap-2 cursor-pointer hover:bg-gray-500/20 transition p-1 rounded-md"},[e("div",{class:f(["avatar",s.status==="online"?"online":"offline"])},[e("div",ce,[e("img",{src:s.userPhotoURL},null,8,re)])],2),e("div",ue,[e("h1",ve,u(s.userName),1),me])],8,ie)]))),128)),e("dialog",_e,[e("div",he,[e("div",fe,[e("form",pe,[e("button",ge,[p(o(N),{icon:"carbon:close",class:"text-xl text-red-500"})])])]),e("div",xe,[e("div",ye,[e("div",be,[e("img",{src:o(n).userPhotoURL},null,8,Ie)])]),e("div",null,[e("h1",we,u(o(n).userName),1)])]),ke,e("div",Ne,[b.value.length===0&&!_.value?(d(),l("div",Me,[e("span",Ue,[k("No conversation with chef "),e("span",Le,u(o(n).userName),1)])])):h("",!0),(d(!0),l(I,null,w(b.value,s=>(d(),l("div",{key:s.id},[e("div",{class:f(["chat",s.senderId===o(i)?"chat-end":"chat-start"])},[e("div",$e,[e("div",De,[o(i)===s.senderId?(d(),l("img",{key:0,src:o(j)},null,8,je)):(d(),l("img",{key:1,src:o(n).userPhotoURL},null,8,Be))])]),e("div",Ce,[k(u(s.senderId===o(i)?o(C):o(n).userName)+" ",1),e("time",Te,u(S(s.timestamp)),1)]),e("div",{class:f(["chat-bubble text-sm",o(i)===s.senderId?"chat-bubble-primary":""])},u(s.message),3)],2)]))),128)),_.value?(d(),l("div",Ve,[p(le)])):h("",!0)]),e("form",{action:"",onSubmit:F(q,["prevent"])},[e("div",qe,[J(e("input",{type:"text",disabled:v.value,required:"","onUpdate:modelValue":a[0]||(a[0]=s=>c.value=s),placeholder:"Enter a message..",class:"input input-bordered w-full placeholder:text-sm rounded-full"},null,8,Se),[[G,c.value]]),v.value?(d(),l("span",Re)):h("",!0),v.value?h("",!0):(d(),l("button",{key:1,class:f(["rounded-full btn transition",c.value===""?"hidden":""])},[p(o(N),{icon:"bxs:send",class:"text-xl text-blue-500"})],2))])],32)])])]))}};export{He as default};
