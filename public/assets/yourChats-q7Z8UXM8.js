import{o as l,c as d,d as A,l as F,k as c,E as G,s as k,u as w,D as o,a as e,b as g,t as u,m as N,x as f,n as J,p as K,v as O,q as p,z as Q,G as W}from"./index-Cr-PPhw3.js";import{I as M}from"./iconify-BEOusgv0.js";import{g as X}from"./getUsers-FtIhv9Rv.js";import{_ as Y,u as Z,a as ee,c as U,s as se,q as te,o as oe,w as T,d as ae}from"./_plugin-vue_export-helper-DTfP13uL.js";const ne={},le={class:"my-3"},de=A('<div class="flex flex-col gap-4 w-32 ml-2"><div class="flex gap-2 items-center"><div class="skeleton w-10 h-10 rounded-full shrink-0"></div><div class="flex flex-col gap-2"><div class="skeleton h-2 w-10"></div><div class="skeleton h-2 w-20"></div></div></div></div><div class="flex justify-end mr-5"><div class="flex flex-col gap-4 w-32"><div class="flex gap-2 items-center"><div class="flex flex-col gap-2"><div class="skeleton h-2 w-20"></div><div class="skeleton h-2 w-10"></div></div><div class="skeleton w-10 h-10 rounded-full shrink-0"></div></div></div></div>',2),ie=[de];function ce(C,x){return l(),d("div",le,ie)}const re=Y(ne,[["render",ce]]),ue=["onClick"],ve={class:"w-10 rounded-full"},me=["src"],_e={class:""},he={class:"text-sm font-medium"},fe=e("span",{class:"text-xs px-2 bg-blue-500/20 text-blue-500 rounded-full"},"test",-1),pe={id:"openInbox",class:"modal modal-bottom sm:modal-middle"},ge={class:"modal-box relative pb-4 pt-2 px-2"},xe={class:"modal-action absolute z-10 -top-4 right-2"},ye={method:"dialog"},be={class:"btn btn-xs px-0.5 rounded-full"},Ie={class:"flex justify-start items-center gap-2"},ke={class:"avatar"},we={class:"w-10 rounded-full"},Ne=["src"],Me={class:"text-sm font-medium"},Ue=e("hr",{class:"my-1 border border-gray-400/20"},null,-1),Te={key:0,class:"my-2 flex justify-center items-center text-sm"},Ce={class:"py-1 px-4 bg-primary/10 rounded-full"},Le={class:"text-primary font-semibold"},$e={class:"chat-image avatar"},De={class:"w-10 rounded-full"},je=["src"],Be=["src"],Ve={class:"chat-header text-xs font-medium"},qe={class:"text-[10px] opacity-50"},Se={key:1},Ee={class:"my-1 flex justify-start items-center gap-2"},Re=["disabled"],ze={key:0,class:"loading loading-ring loading-lg"},Ge={__name:"yourChats",setup(C){const x=F(),L=c(x.currentUser),{firestore:y}=Z(),{uid:$,photoURL:D,displayName:j}=L.value,i=$,B=j,{storedUsers:V}=X();let n=c([]);const r=c(""),b=c([]),_=c(!1),v=c(!1),h=c(null),q=t=>{document.getElementById("openInbox").showModal(),n.value=t,console.log(n.value.userId),H()},S=async()=>{if(r.value.trim()!==""){v.value=!0,console.log("sending");try{await ee(U(y,"messages"),{senderId:i,recipientId:n.value.userId,message:r.value,timestamp:se()}),console.log("send!"),v.value=!1}catch{}r.value=""}},I=G(()=>b.value.filter(t=>t.senderId===i&&t.recipientId===n.value.userId||t.senderId===n.value.userId&&t.recipientId===i)),E=t=>{if(t){const a=R(t),s=a.getHours()%12||12,m=("0"+a.getMinutes()).slice(-2),P=a.getHours()<12?"am":"pm";return`${s}:${m} ${P}`}},R=t=>{const a=t.nanoseconds/1e6,s=t.seconds;return a?new Date(s*1e3+a):jsDate},z=()=>{W(()=>{h.value&&(h.value.scrollTop=h.value.scrollHeight)})},H=()=>{_.value=!0;const t=te(U(y,"messages"),T("senderId","in",[i,n.value.userId]),T("recipientId","in",[i,n.value.userId]),oe("timestamp","asc")),a=ae(t,s=>{b.value=s.docs.map(m=>({id:m.id,...m.data()})),_.value=!1,z()});Q(()=>{a&&a()})};return(t,a)=>(l(),d("div",null,[(l(!0),d(k,null,w(o(V),s=>(l(),d("div",{key:s.id},[e("div",{onClick:m=>q(s),class:"flex justify-start items-center gap-2 cursor-pointer hover:bg-gray-500/20 transition p-1 rounded-md"},[e("div",{class:p(["avatar",s.status==="online"?"online":"offline"])},[e("div",ve,[e("img",{src:s.userPhotoURL},null,8,me)])],2),e("div",_e,[e("h1",he,u(s.userName),1),fe])],8,ue)]))),128)),e("dialog",pe,[e("div",ge,[e("div",xe,[e("form",ye,[e("button",be,[g(o(M),{icon:"carbon:close",class:"text-xl text-red-500"})])])]),e("div",Ie,[e("div",ke,[e("div",we,[e("img",{src:o(n).userPhotoURL},null,8,Ne)])]),e("div",null,[e("h1",Me,u(o(n).userName),1)])]),Ue,e("div",{class:"h-80 rounded-md overflow-y-scroll",ref_key:"messageContainer",ref:h},[I.value.length===0&&!_.value?(l(),d("div",Te,[e("span",Ce,[N("No conversation with chef "),e("span",Le,u(o(n).userName),1)])])):f("",!0),(l(!0),d(k,null,w(I.value,s=>(l(),d("div",{key:s.id},[e("div",{class:p(["chat",s.senderId===o(i)?"chat-end":"chat-start"])},[e("div",$e,[e("div",De,[o(i)===s.senderId?(l(),d("img",{key:0,src:o(D)},null,8,je)):(l(),d("img",{key:1,src:o(n).userPhotoURL},null,8,Be))])]),e("div",Ve,[N(u(s.senderId===o(i)?o(B):o(n).userName)+" ",1),e("time",qe,u(E(s.timestamp)),1)]),e("div",{class:p(["chat-bubble text-sm",o(i)===s.senderId?"chat-bubble-primary":""])},u(s.message),3)],2)]))),128)),_.value?(l(),d("div",Se,[g(re)])):f("",!0)],512),e("form",{action:"",onSubmit:J(S,["prevent"])},[e("div",Ee,[K(e("input",{type:"text",disabled:v.value,required:"","onUpdate:modelValue":a[0]||(a[0]=s=>r.value=s),placeholder:"Enter a message..",class:"input input-bordered w-full placeholder:text-sm rounded-full"},null,8,Re),[[O,r.value]]),v.value?(l(),d("span",ze)):f("",!0),v.value?f("",!0):(l(),d("button",{key:1,class:p(["rounded-full btn transition",r.value===""?"hidden":""])},[g(o(M),{icon:"bxs:send",class:"text-xl text-blue-500"})],2))])],32)])])]))}};export{Ge as default};
